<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - iGaroto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-geo@4.3.0/build/index.umd.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>


    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f1f3f4; }
        .sidebar-item.active { background-color: #e8f0fe; color: #1967d2; font-weight: 700; }
        .sidebar-item.active i { color: #1967d2; }
        .admin-view { display: none; }
        .active-view { display: block !important; }
        #post-editor-container, #page-editor-container { height: 60vh; background-color: white; border-radius: 8px; border: 1px solid #d1d5db; }
        .ql-toolbar.ql-snow { border-top-left-radius: 8px; border-top-right-radius: 8px; border-color: #d1d5db; }
        .ql-container.ql-snow { border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; border-color: #d1d5db; border-top: 0px; }
        .ql-font-roboto { font-family: 'Roboto', sans-serif; }
        .ql-font-lato { font-family: 'Lato', sans-serif; }
        .ql-font-merriweather { font-family: 'Merriweather', serif; }
        .ql-font-arial { font-family: Arial, sans-serif; }
        .list-item .item-actions, .gadget .gadget-actions { opacity: 0; transition: opacity 0.2s ease-in-out; }
        .list-item:hover .item-actions, .gadget:hover .gadget-actions { opacity: 1; }
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 50; right: 0; border-radius: 8px; }
        .dropdown-content a:hover {background-color: #f1f1f1}
        .dropdown:hover .dropdown-content { display: block; }
        .comment-actions { opacity: 0; transition: opacity 0.2s ease-in-out; }
        .comment-item:hover .comment-actions { opacity: 1; }
        .comments-tab.active { border-color: #1967d2; color: #1967d2; }
        .gadget-container { border: 2px dashed #d1d5db; padding: 1rem; border-radius: 8px; min-height: 100px; }
        .gadget { cursor: grab; user-select: none; }
        .gadget.dragging { opacity: 0.5; background: #e8f0fe; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .theme-card { border: 2px solid transparent; transition: border-color 0.2s ease-in-out; }
        .theme-card.active { border-color: #1967d2; }
        .theme-card .apply-button-container { display: none; }
        .theme-card.active .apply-button-container { display: block; }
        .setting-item { padding: 1rem 0; border-bottom: 1px solid #e5e7eb; }
        .setting-item:last-child { border-bottom: none; }
        .setting-item h4 { font-size: 1rem; font-weight: 500; color: #111827; }
        .setting-item p { font-size: 0.875rem; color: #6b7280; }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.3); width: 36px; height: 36px; border-radius: 50%; border-left-color: #ffffff; animation: spin 1s ease infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100">

    <div id="login-screen" class="flex items-center justify-center h-screen">
        <div class="w-full max-w-md bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Admin iGaroto</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                    <input type="password" id="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full">Entrar</button>
                </div>
                <p id="login-error" class="text-red-500 text-xs italic mt-4 text-center"></p>
            </form>
        </div>
    </div>

    <div id="app-container" class="hidden h-screen bg-gray-100">
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <div class="px-6 py-4 border-b flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-700">iGAROTO</h1>
                <button id="logout-btn" title="Sair" class="text-gray-500 hover:text-red-600"><i data-lucide="log-out" class="w-5 h-5"></i></button>
            </div>
            <div class="p-4">
                <button id="new-post-btn" class="w-full bg-orange-500 text-white font-bold py-3 px-4 rounded-lg inline-flex items-center justify-center shadow hover:bg-orange-600 transition-colors">
                    <i data-lucide="plus" class="w-5 h-5 mr-2"></i><span>NOVA POSTAGEM</span>
                </button>
            </div>
            <nav id="sidebar-nav" class="flex-1 py-2 px-2 space-y-1">
                <a href="#" id="posts-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="layout-list" class="w-5 h-5 mr-3 text-gray-500"></i>Postagens</a>
                <a href="#" id="stats-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="bar-chart-3" class="w-5 h-5 mr-3 text-gray-500"></i>Estatísticas</a>
                <a href="#" id="comments-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="message-square" class="w-5 h-5 mr-3 text-gray-500"></i>Comentários</a>
                <a href="#" id="pages-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="file-text" class="w-5 h-5 mr-3 text-gray-500"></i>Páginas</a>
                <a href="#" id="layout-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="layout-template" class="w-5 h-5 mr-3 text-gray-500"></i>Layout</a>
                <a href="#" id="theme-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="palette" class="w-5 h-5 mr-3 text-gray-500"></i>Tema</a>
                <a href="#" id="settings-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="settings" class="w-5 h-5 mr-3 text-gray-500"></i>Configurações</a>
            </nav>
            <div class="px-4 py-2 border-t">
                <a href="index.html" target="_blank" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-200"><i data-lucide="eye" class="w-5 h-5 mr-3 text-gray-500"></i>Ver blog</a>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header id="main-header" class="bg-white border-b border-gray-200 p-2 flex items-center justify-between">
                 <div class="relative w-full max-w-md">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                    <input type="text" placeholder="Pesquisar" class="w-full bg-gray-100 rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex items-center gap-4">
                    <button class="text-gray-500 hover:text-gray-800"><i data-lucide="help-circle" class="w-6 h-6"></i></button>
                    <img id="user-avatar" src="https://placehold.co/40x40/ff8a8a/ffffff?text=W" alt="User Avatar" class="w-8 h-8 rounded-full cursor-pointer">
                </div>
            </header>
            <header id="editor-header" class="hidden bg-white border-b border-gray-200 p-2 items-center justify-between">
                <div class="flex items-center gap-2">
                    <button id="back-btn" class="text-gray-500 hover:text-gray-800 p-2 rounded-full hover:bg-gray-100"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
                    <input id="editor-title-input" type="text" placeholder="Título da postagem" class="text-2xl bg-transparent focus:outline-none w-full placeholder-gray-400 font-normal">
                </div>
                <div class="flex items-center gap-3 mr-4">
                    <button class="text-sm text-gray-700 hover:bg-gray-100 px-4 py-2 rounded-md border">Visualizar</button>
                    <button id="publish-btn" class="text-sm text-white bg-orange-500 hover:bg-orange-600 px-5 py-2 rounded-md font-bold">Publicar</button>
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                
                <div id="posts-list-view" class="admin-view">
                    <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Postagens</h2></div>
                    <div id="posts-container" class="bg-white rounded-lg shadow-sm border border-gray-200"></div>
                </div>

                <div id="post-editor-view" class="admin-view">
                     <div class="flex flex-col lg:flex-row gap-6">
                         <div class="flex-1"><div id="post-editor-wrapper"><div id="post-editor-container"></div></div></div>
                         <aside class="w-full lg:w-80">
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 space-y-6">
                                <div>
                                    <h3 class="font-bold text-sm mb-3 border-b pb-2">Configurações da postagem</h3>
                                    <label for="tags-input" class="block text-sm font-medium text-gray-700 mb-1">Marcadores</label>
                                    <input type="text" id="tags-input" placeholder="Separe com vírgulas" class="w-full border border-gray-300 rounded-md p-2 text-sm">
                                </div>
                                <div>
                                    <h3 class="font-bold text-sm mb-2 border-b pb-2 pt-2">Opções</h3>
                                    <label for="post-comments-select" class="block text-sm font-medium text-gray-700 mb-1">Comentários</label>
                                    <select id="post-comments-select" class="w-full border border-gray-300 rounded-md p-2 text-sm">
                                        <option value="allow">Permitir</option><option value="disallow">Não permitir</option>
                                    </select>
                                </div>
                            </div>
                         </aside>
                     </div>
                </div>
                
                <div id="pages-list-view" class="admin-view">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-normal text-gray-800">Páginas</h2>
                        <button id="new-page-btn" class="bg-orange-500 text-white font-bold py-2 px-4 rounded-md inline-flex items-center shadow hover:bg-orange-600 transition-colors">
                            <i data-lucide="plus" class="w-5 h-5 mr-2"></i>NOVA PÁGINA
                        </button>
                    </div>
                    <div id="pages-container" class="bg-white rounded-lg shadow-sm border border-gray-200"></div>
                </div>

                <div id="page-editor-view" class="admin-view">
                     <div class="flex flex-col lg:flex-row gap-6">
                         <div class="flex-1"><div id="page-editor-wrapper"><div id="page-editor-container"></div></div></div>
                         <aside class="w-full lg:w-80">
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 space-y-6">
                                <div>
                                    <h3 class="font-bold text-sm mb-3 border-b pb-2">Opções</h3>
                                    <label for="page-comments-select" class="block text-sm font-medium text-gray-700 mb-1">Comentários</label>
                                    <select id="page-comments-select" class="w-full border border-gray-300 rounded-md p-2 text-sm">
                                        <option value="allow">Permitir</option><option value="disallow" selected>Não permitir</option>
                                    </select>
                                </div>
                            </div>
                         </aside>
                     </div>
                </div>

                <div id="settings-view" class="admin-view">
                    <h2 class="text-2xl font-normal text-gray-800 mb-6">Configurações</h2>
                    <div class="max-w-4xl mx-auto space-y-8">
                        <div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-semibold text-gray-900 border-b pb-3 mb-4">Básico</h3><div class="space-y-4"><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-title">Título</h4><p id="setting-title-value" class="text-gray-500">iGaroto</p></div><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-description">Descrição</h4><p id="setting-description-value" class="text-gray-500">Adicionar descrição do blog</p></div><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-language">Idioma do blog</h4><p id="setting-language-value" class="text-gray-500">Português (Brasil)</p></div><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-favicon">Favicon</h4><p class="text-gray-500">Nenhum favicon selecionado</p></div></div></div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-semibold text-gray-900 border-b pb-3 mb-4">Publicação</h3><div class="space-y-4"><div class="setting-item"><h4>Endereço do blog</h4><p class="text-gray-500">igaroto.com</p></div><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-custom-domain">Domínio personalizado</h4><p class="text-gray-500">Aponte um URL de seu domínio para o blog</p></div></div></div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-semibold text-gray-900 border-b pb-3 mb-4">HTTPS</h3><div class="setting-item flex justify-between items-center"><div><h4>Redirecionamento para HTTPS</h4><p>Redirecionar visitantes de http:// para https://</p></div><label class="flex items-center cursor-pointer"><div class="relative"><input type="checkbox" class="sr-only" checked><div class="block bg-blue-500 w-14 h-8 rounded-full"></div><div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform translate-x-full"></div></div></label></div></div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-semibold text-gray-900 border-b pb-3 mb-4">Permissões</h3><div class="space-y-4"><div class="setting-item"><h4>Administradores e autores do blog</h4><p class="text-gray-500">iGaroto (Admin)</p></div><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-invite-authors">Convidar mais autores</h4></div></div></div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-semibold text-gray-900 border-b pb-3 mb-4">Gerenciar blog</h3><div class="space-y-4"><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-import">Importar conteúdo</h4><p>Importar postagens e comentários de um arquivo .xml</p></div><div class="setting-item"><h4 class="cursor-pointer hover:text-blue-600" id="setting-backup">Fazer backup do conteúdo</h4><p>Fazer o download de postagens e comentários</p></div></div></div>
                    </div>
                </div>

                <div id="stats-view" class="admin-view">
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="bg-white p-4 rounded-lg shadow-sm border flex items-center justify-between"><span class="text-gray-600">Seguidores</span><span id="stats-followers-count" class="text-2xl font-bold">0</span></div><div class="bg-white p-4 rounded-lg shadow-sm border flex items-center justify-between"><span class="text-gray-600">Postagens</span><span id="stats-posts-count" class="text-2xl font-bold">0</span></div><div class="bg-white p-4 rounded-lg shadow-sm border flex items-center justify-between"><span class="text-gray-600">Comentários</span><span id="stats-comments-count" class="text-2xl font-bold">0</span></div></div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border"><div class="flex justify-between items-start mb-4"><h3 class="text-lg font-medium">Visualizações do iGaroto</h3><div class="dropdown"><button class="flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900"><span id="time-filter-label">Última semana</span><i data-lucide="chevron-down" class="w-4 h-4"></i></button><div id="time-filter-options" class="dropdown-content"><a href="#" data-period="week">Última semana</a><a href="#" data-period="month">Últimos 30 dias</a><a href="#" data-period="all">Todo o período</a></div></div></div><div class="relative h-72"><canvas id="overallViewsChart"></canvas></div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Locais principais</h3><div class="relative h-96"><canvas id="countryMapChart"></canvas></div></div><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Público-alvo por país</h3><div class="relative h-96"><canvas id="countryDonutChart"></canvas></div></div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Navegadores</h3><div class="relative h-72"><canvas id="browserDonutChart"></canvas></div></div><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Sistemas Operacionais</h3><div class="relative h-72"><canvas id="osDonutChart"></canvas></div></div></div>
                    </div>
                </div>
                
                <div id="comments-view" class="admin-view">
                    <h2 class="text-2xl font-normal text-gray-800 mb-4">Comentários</h2>
                    <div class="border-b border-gray-200"><nav id="comments-tabs" class="-mb-px flex space-x-8" aria-label="Tabs"><a href="#" data-tab="published" class="comments-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Publicados</a><a href="#" data-tab="spam" class="comments-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Spam</a></nav></div>
                    <div id="published-comments-list" class="mt-6"></div><div id="spam-comments-list" class="hidden mt-6"></div>
                </div>

                <div id="layout-view" class="admin-view">
                    <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Layout</h2><button id="save-layout-btn" class="bg-orange-500 text-white font-bold py-2 px-6 rounded-md shadow hover:bg-orange-600 transition-colors">Salvar</button></div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Menu Principal</h3><div id="main-menu-gadgets" class="gadget-container space-y-3"></div><button data-section="main-menu" class="add-gadget-btn mt-4 text-sm text-blue-600 hover:text-blue-800">+ Adicionar um Gadget</button></div></div><div class="space-y-6"><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Barra Lateral</h3><div id="sidebar-gadgets" class="gadget-container space-y-3"></div><button data-section="sidebar" class="add-gadget-btn mt-4 text-sm text-blue-600 hover:text-blue-800">+ Adicionar um Gadget</button></div></div></div>
                </div>
                
                <div id="theme-view" class="admin-view">
                    <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Tema</h2></div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Meu tema</h3><div class="flex gap-6"><div id="current-theme-thumbnail" class="w-1/3"></div><div class="flex-1"><h4 id="current-theme-name" class="text-xl font-semibold"></h4><p class="text-gray-600 mb-4">Este é o tema que está ativo no seu blog.</p><div class="flex gap-4"><button id="customize-theme-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700">Personalizar</button><button id="edit-html-btn" class="border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md hover:bg-gray-100">Editar HTML</button></div></div></div></div>
                    <div id="theme-gallery" class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>

                <div id="theme-customizer-view" class="admin-view">
                     <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Personalizar Tema</h2><div class="flex gap-4"><button id="back-to-themes-btn" class="border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md hover:bg-gray-100">Voltar</button><button id="save-customizations-btn" class="bg-orange-500 text-white font-bold py-2 px-6 rounded-md shadow hover:bg-orange-600">Salvar</button></div></div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border max-w-2xl mx-auto"><div class="space-y-6"><div><label for="bg-color-picker" class="block text-sm font-medium text-gray-700">Cor de fundo principal</label><input type="color" id="bg-color-picker" class="mt-1 w-full h-10 p-1 border border-gray-300 rounded-md"></div><div><label for="text-color-picker" class="block text-sm font-medium text-gray-700">Cor do texto principal</label><input type="color" id="text-color-picker" class="mt-1 w-full h-10 p-1 border border-gray-300 rounded-md"></div><div><label for="link-color-picker" class="block text-sm font-medium text-gray-700">Cor dos links</label><input type="color" id="link-color-picker" class="mt-1 w-full h-10 p-1 border border-gray-300 rounded-md"></div></div></div>
                </div>
            </main>
        </div>
    </div>

    <div id="edit-html-modal" class="modal-overlay hidden"><div class="bg-white rounded-lg shadow-xl w-full max-w-4xl h-5/6 flex flex-col"><div class="p-4 border-b flex justify-between items-center"><h3 class="text-xl font-medium">Editar HTML do Tema</h3><button id="close-html-modal-btn" class="text-gray-500 hover:text-gray-800">&times;</button></div><div class="p-4 flex-1"><textarea id="theme-html-editor" class="w-full h-full border border-gray-300 rounded-md font-mono text-sm p-2 resize-none"></textarea></div><div class="p-4 bg-gray-50 rounded-b-lg flex justify-end gap-4"><button id="cancel-html-edit-btn" class="text-gray-700 hover:bg-gray-200 px-4 py-2 rounded-md border">Cancelar</button><button id="save-html-edit-btn" class="text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md">Salvar Tema</button></div></div></div>
    <div id="add-gadget-modal" class="modal-overlay hidden"><div class="bg-white rounded-lg shadow-xl w-full max-w-lg"><div class="p-6 border-b flex justify-between items-center"><h3 class="text-xl font-medium">Adicionar um Gadget</h3><button id="close-gadget-modal-btn" class="text-gray-500 hover:text-gray-800">&times;</button></div><div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4"><div data-type="pages" class="gadget-option p-4 border rounded-lg hover:bg-gray-100 cursor-pointer"><h4 class="font-semibold">Páginas</h4><p class="text-sm text-gray-500">Exibe uma lista de páginas.</p></div><div data-type="search" class="gadget-option p-4 border rounded-lg hover:bg-gray-100 cursor-pointer"><h4 class="font-semibold">Pesquisa do blog</h4><p class="text-sm text-gray-500">Adiciona uma caixa de pesquisa.</p></div><div data-type="html" class="gadget-option p-4 border rounded-lg hover:bg-gray-100 cursor-pointer"><h4 class="font-semibold">HTML/JavaScript</h4><p class="text-sm text-gray-500">Adiciona código de terceiros.</p></div><div data-type="links" class="gadget-option p-4 border rounded-lg hover:bg-gray-100 cursor-pointer"><h4 class="font-semibold">Lista de links</h4><p class="text-sm text-gray-500">Cria uma lista de links.</p></div><div data-type="social" class="gadget-option p-4 border rounded-lg hover:bg-gray-100 cursor-pointer"><h4 class="font-semibold">Plugin Social</h4><p class="text-sm text-gray-500">Exibe ícones de redes sociais.</p></div></div></div></div>
    <div id="configure-gadget-modal" class="modal-overlay hidden"><div class="bg-white rounded-lg shadow-xl w-full max-w-lg"><div class="p-6 border-b flex justify-between items-center"><h3 id="configure-modal-title" class="text-xl font-medium">Configurar Gadget</h3><button id="close-configure-modal-btn" class="text-gray-500 hover:text-gray-800">&times;</button></div><div class="p-6 space-y-4"><div><label for="gadget-title-input" class="block text-sm font-medium text-gray-700">Título</label><input type="text" id="gadget-title-input" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div><div id="gadget-specific-config" class="space-y-4"></div></div><div class="p-6 bg-gray-50 rounded-b-lg flex justify-end gap-4"><button id="cancel-configure-btn" class="text-gray-700 hover:bg-gray-200 px-4 py-2 rounded-md border">Cancelar</button><button id="save-configure-btn" class="text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md">Salvar</button></div></div></div>
    <div id="settings-modal" class="modal-overlay hidden"><div class="bg-white rounded-lg shadow-xl w-full max-w-lg"><div class="p-6 border-b flex justify-between items-center"><h3 id="settings-modal-title" class="text-xl font-medium"></h3><button id="close-settings-modal-btn" class="text-gray-500 hover:text-gray-800">&times;</button></div><div id="settings-modal-content" class="p-6 space-y-4"></div><div class="p-4 bg-gray-50 rounded-b-lg flex justify-end gap-4"><button id="cancel-settings-btn" class="text-gray-700 hover:bg-gray-200 px-4 py-2 rounded-md border">Cancelar</button><button id="save-settings-btn" class="text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md">Salvar</button></div></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
          apiKey: "AIzaSyBYvn_AEoXo2ei2zRSg9EZhAeicF0QfY3s",
          authDomain: "igaroto-site-oficial.firebaseapp.com",
          projectId: "igaroto-site-oficial",
          storageBucket: "igaroto-site-oficial.firebasestorage.app",
          messagingSenderId: "217633468562",
          appId: "1:217633468562:web:236b1b72034a5a675cb64b",
          measurementId: "G-B9NBBEZTSW"
        };
        firebase.initializeApp(firebaseConfig);
        
        const auth = firebase.auth();
        const db = firebase.firestore();

        const loginScreen = document.getElementById('login-screen');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const logoutBtn = document.getElementById('logout-btn');
        const loginError = document.getElementById('login-error');

        function showApp() { loginScreen.style.display = 'none'; appContainer.style.display = 'flex'; runApp(); }
        function showLogin() { loginScreen.style.display = 'flex'; appContainer.style.display = 'none'; }

        auth.onAuthStateChanged(user => { (user && !user.isAnonymous) ? showApp() : showLogin(); });
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            loginError.textContent = '';
            auth.signInWithEmailAndPassword(email, password).catch(error => { loginError.textContent = 'E-mail ou senha inválidos.'; });
        });
        logoutBtn.addEventListener('click', () => { auth.signOut(); });

        function runApp() {
            const elements = {
                publishBtn: document.getElementById('publish-btn'), editorTitleInput: document.getElementById('editor-title-input'), tagsInput: document.getElementById('tags-input'), postsContainer: document.getElementById('posts-container'), newPostBtn: document.getElementById('new-post-btn'), backBtn: document.getElementById('back-btn'), newPageBtn: document.getElementById('new-page-btn'), postsLink: document.getElementById('posts-link'), statsLink: document.getElementById('stats-link'), commentsLink: document.getElementById('comments-link'), pagesLink: document.getElementById('pages-link'), layoutLink: document.getElementById('layout-link'), themeLink: document.getElementById('theme-link'), settingsLink: document.getElementById('settings-link'),
                pagesContainer: document.getElementById('pages-container'), publishedCommentsList: document.getElementById('published-comments-list'), spamCommentsList: document.getElementById('spam-comments-list'), commentsTabs: document.getElementById('comments-tabs'), timeFilterOptions: document.getElementById('time-filter-options'), timeFilterLabel: document.getElementById('time-filter-label'),
                saveLayoutBtn: document.getElementById('save-layout-btn'), addGadgetBtns: document.querySelectorAll('.add-gadget-btn'), addGadgetModal: document.getElementById('add-gadget-modal'), closeGadgetModalBtn: document.getElementById('close-gadget-modal-btn'), gadgetOptions: document.querySelectorAll('.gadget-option'), configureGadgetModal: document.getElementById('configure-gadget-modal'), closeConfigureModalBtn: document.getElementById('close-configure-modal-btn'), configureModalTitle: document.getElementById('configure-modal-title'), gadgetTitleInput: document.getElementById('gadget-title-input'), gadgetSpecificConfig: document.getElementById('gadget-specific-config'), saveConfigureBtn: document.getElementById('save-configure-btn'), cancelConfigureBtn: document.getElementById('cancel-configure-btn'),
                themeGallery: document.getElementById('theme-gallery'), currentThemeThumbnail: document.getElementById('current-theme-thumbnail'), currentThemeName: document.getElementById('current-theme-name'), customizeThemeBtn: document.getElementById('customize-theme-btn'), editHtmlBtn: document.getElementById('edit-html-btn'), backToThemesBtn: document.getElementById('back-to-themes-btn'), saveCustomizationsBtn: document.getElementById('save-customizations-btn'), bgColorPicker: document.getElementById('bg-color-picker'), textColorPicker: document.getElementById('text-color-picker'), linkColorPicker: document.getElementById('link-color-picker'), editHtmlModal: document.getElementById('edit-html-modal'), closeHtmlModalBtn: document.getElementById('close-html-modal-btn'), cancelHtmlEditBtn: document.getElementById('cancel-html-edit-btn'), saveHtmlEditBtn: document.getElementById('save-html-edit-btn'), themeHtmlEditor: document.getElementById('theme-html-editor'),
                settingsModal: document.getElementById('settings-modal'), closeSettingsModalBtn: document.getElementById('close-settings-modal-btn'), settingsModalTitle: document.getElementById('settings-modal-title'), settingsModalContent: document.getElementById('settings-modal-content'), saveSettingsBtn: document.getElementById('save-settings-btn'), cancelSettingsBtn: document.getElementById('cancel-settings-btn'),
            };

            const views = {
                posts: document.getElementById('posts-list-view'), postEditor: document.getElementById('post-editor-view'), pages: document.getElementById('pages-list-view'), pageEditor: document.getElementById('page-editor-view'), stats: document.getElementById('stats-view'), comments: document.getElementById('comments-view'), layout: document.getElementById('layout-view'), theme: document.getElementById('theme-view'), settings: document.getElementById('settings-view'), themeCustomizer: document.getElementById('theme-customizer-view')
            };

            const navLinks = {
                posts: document.getElementById('posts-link'), stats: document.getElementById('stats-link'), comments: document.getElementById('comments-link'), pages: document.getElementById('pages-link'), layout: document.getElementById('layout-link'), theme: document.getElementById('theme-link'), settings: document.getElementById('settings-link'),
            };

            let lastListView = 'posts';
            let currentEditor = null;
            const uploadModal = document.getElementById('upload-modal');
            let comments = JSON.parse(localStorage.getItem('adminComments')) || [];
            let layout = { sidebar: [], 'main-menu': [] };
            let blogSettings = JSON.parse(localStorage.getItem('adminBlogSettings')) || { title: 'iGaroto', description: 'Adicionar descrição do blog', language: 'pt-br' };
            const availableThemes = [
                { id: 'simple', name: 'Simples', thumbnail: 'https://placehold.co/400x250/f1f3f4/333?text=Simples' },
                { id: 'dark', name: 'Escuro', thumbnail: 'https://placehold.co/400x250/333/f1f3f4?text=Escuro' },
                { id: 'vibrant', name: 'Vibrante', thumbnail: 'https://placehold.co/400x250/db2777/fff?text=Vibrante' },
            ];
            let themeSettings = JSON.parse(localStorage.getItem('adminThemeSettings')) || { activeThemeId: 'simple', customizations: { simple: { bg: '#ffffff', text: '#333333', link: '#0000ff' }, dark: { bg: '#333333', text: '#ffffff', link: '#60a5fa' }, vibrant: { bg: '#ffffff', text: '#1f2937', link: '#db2777' }}};
            let charts = {};
            let currentGadgetSection = null;
            let editingGadgetId = null;

            async function vercelBlobUpload(file) {
                uploadModal.classList.remove('hidden');
                const response = await fetch(`/api/upload-image?filename=${file.name}`, { method: 'POST', body: file });
                if (!response.ok) { throw new Error('A resposta da rede para o upload não foi ok.'); }
                const newBlob = await response.json();
                uploadModal.classList.add('hidden');
                return newBlob.url;
            }
            
            function imageHandler() {
                const input = document.createElement('input');
                input.setAttribute('type', 'file'); input.setAttribute('accept', 'image/*');
                input.click();
                input.onchange = async () => {
                    const file = input.files[0]; if (!file) return;
                    if (/^image\//.test(file.type)) {
                        try {
                            const url = await vercelBlobUpload(file);
                            const range = this.quill.getSelection(true);
                            this.quill.insertEmbed(range.index, 'image', url);
                        } catch (error) { console.error('Falha no upload da imagem:', error); alert('Falha no upload da imagem.'); uploadModal.classList.add('hidden');}
                    } else { alert('Por favor, selecione um arquivo de imagem válido.'); }
                };
            }

            const quillOptions = { modules: { toolbar: { container: [
                [{ 'font': ['roboto', 'lato', 'merriweather', 'arial'] }], [{ 'header': [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'], ['blockquote', 'code-block'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'align': [] }], ['link', 'image'], ['clean']
            ], handlers: { 'image': imageHandler }}}, theme: 'snow', placeholder: 'Comece a escrever...'};
            const postQuill = new Quill('#post-editor-container', quillOptions);
            const pageQuill = new Quill('#page-editor-container', { theme: 'snow', placeholder: 'Conteúdo da página...'});

            const renderPosts = async () => { try { elements.postsContainer.innerHTML = '<p class="p-4 text-center text-gray-500">Carregando...</p>'; const snapshot = await db.collection('posts').orderBy('createdAt', 'desc').get(); elements.postsContainer.innerHTML = ''; if (snapshot.empty) { elements.postsContainer.innerHTML = `<p class="p-4 text-center text-gray-500">Nenhuma postagem.</p>`; return; } snapshot.forEach(doc => { const post = { id: doc.id, ...doc.data() }; const el = document.createElement('div'); el.className = 'list-item flex items-center p-4 border-b last:border-b-0'; const postDate = post.createdAt?.toDate().toLocaleDateString('pt-BR', {day:'numeric', month:'short'}) || ''; el.innerHTML = `<div class="flex-1 cursor-pointer" onclick="window.editPost('${post.id}')"><p class="font-medium">${post.title||'(S/ Título)'}</p><div class="text-sm text-gray-500 mt-1"><span>Publicada</span> &middot; <span>${postDate}</span></div></div><div class="item-actions flex items-center gap-3 text-gray-500"><button onclick="window.deletePost('${post.id}')" title="Excluir"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>`; elements.postsContainer.appendChild(el); }); lucide.createIcons(); } catch (error) { console.error("Erro ao carregar posts:", error); }};
            window.editPost = async (id) => { const docSnap = await db.collection('posts').doc(id).get(); if (docSnap.exists) { const post = docSnap.data(); currentEditor = 'post'; elements.editorTitleInput.value = post.title; elements.tagsInput.value = post.tags?.join(', ') || ''; postQuill.root.innerHTML = post.content; elements.publishBtn.dataset.id = id; switchView('postEditor'); }};
            window.deletePost = async (id) => { if (confirm('Excluir este post?')) { await db.collection('posts').doc(id).delete(); renderPosts(); }};
            const renderPages = async () => { try { views.pages.innerHTML = '<p class="p-4 text-center text-gray-500">Carregando...</p>'; const snapshot = await db.collection('pages').orderBy('createdAt', 'desc').get(); views.pages.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Páginas</h2><button id="new-page-btn-inner" class="bg-orange-500 text-white font-bold py-2 px-4 rounded-md inline-flex items-center shadow hover:bg-orange-600 transition-colors"><i data-lucide="plus" class="w-5 h-5 mr-2"></i>NOVA PÁGINA</button></div><div id="pages-container" class="bg-white rounded-lg shadow-sm border border-gray-200"></div>`; const pagesContainer = document.getElementById('pages-container'); if (snapshot.empty) { pagesContainer.innerHTML = `<p class="p-4 text-center text-gray-500">Nenhuma página.</p>`; return; } snapshot.forEach(doc => { const page = { id: doc.id, ...doc.data() }; const el = document.createElement('div'); el.className = 'list-item flex items-center p-4 border-b last:border-b-0'; el.innerHTML = `<div class="flex-1"><p class="font-medium">${page.title||'(S/ Título)'}</p></div>`; pagesContainer.appendChild(el); }); lucide.createIcons(); } catch (e) { console.error(e); }};
            const updateDashboard = async () => { try { views.stats.innerHTML = `<div class="space-y-6"><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="bg-white p-4 rounded-lg shadow-sm border flex items-center justify-between"><span class="text-gray-600">Postagens</span><span id="stats-posts-count" class="text-2xl font-bold">0</span></div></div><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium">Visualizações</h3><div class="relative h-72"><canvas id="overallViewsChart"></canvas></div></div></div>`; const posts = await db.collection('posts').get(); document.getElementById('stats-posts-count').textContent = posts.size; } catch (e) { console.error(e); }};
            const renderComments = () => { views.comments.innerHTML = `<h2 class="text-2xl">Comentários</h2><p class="mt-4 p-4 bg-white rounded-lg">Funcionalidade de comentários em breve.</p>`; };
            const loadLayout = async () => { views.layout.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Layout</h2><button id="save-layout-btn" class="bg-orange-500 text-white font-bold py-2 px-6 rounded-md shadow hover:bg-orange-600 transition-colors">Salvar</button></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Menu Principal</h3><div id="main-menu-gadgets" class="gadget-container space-y-3"></div><button data-section="main-menu" class="add-gadget-btn mt-4 text-sm text-blue-600 hover:text-blue-800">+ Adicionar Gadget</button></div></div><div class="space-y-6"><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Barra Lateral</h3><div id="sidebar-gadgets" class="gadget-container space-y-3"></div><button data-section="sidebar" class="add-gadget-btn mt-4 text-sm text-blue-600 hover:text-blue-800">+ Adicionar Gadget</button></div></div></div>`; };
            const renderThemeView = () => { views.theme.innerHTML = `<h2 class="text-2xl font-normal text-gray-800 mb-6">Tema</h2><div class="bg-white p-6 rounded-lg shadow-sm border"><h3 class="text-lg font-medium mb-4">Meu tema</h3><p>Funcionalidades de tema em breve.</p></div>`; };
            const renderSettings = () => { views.settings.innerHTML = `<h2 class="text-2xl font-normal text-gray-800 mb-6">Configurações</h2><p class="mt-4 p-4 bg-white rounded-lg">Funcionalidades de configurações em breve.</p>`; };

            elements.publishBtn.addEventListener('click', async () => {
                const id = elements.publishBtn.dataset.id;
                const title = elements.editorTitleInput.value.trim();
                if (!title) return alert('Adicione um título.');
                const dataToSave = { title: title, content: postQuill.root.innerHTML, tags: elements.tagsInput.value.split(',').map(t => t.trim()).filter(Boolean), updatedAt: new Date() };
                try { if (id) { await db.collection('posts').doc(id).update(dataToSave); } else { dataToSave.createdAt = new Date(); await db.collection('posts').add(dataToSave); } switchView('posts'); renderPosts(); } catch (error) { console.error("Erro ao salvar post:", error); alert("Erro ao salvar post."); }
            });
            
            const switchView = (viewKey) => {
                Object.values(views).forEach(v => { if(v) v.style.display = 'none'});
                if(views[viewKey]) views[viewKey].style.display = 'block';
                const isEditor = viewKey === 'postEditor' || viewKey === 'pageEditor';
                document.getElementById('main-header').style.display = isEditor ? 'none' : 'flex';
                document.getElementById('editor-header').style.display = isEditor ? 'flex' : 'none';
                Object.values(navLinks).forEach(l => l.classList.remove('active'));
                navLinks[viewKey]?.classList.add('active');
                if(!isEditor) lastListView = viewKey;
            };
            
            Object.keys(navLinks).forEach(key => {
                if(navLinks[key]) {
                    navLinks[key].addEventListener('click', (e) => {
                        e.preventDefault();
                        switchView(key);
                        if(key === 'posts') renderPosts();
                        if(key === 'pages') renderPages();
                        if(key === 'stats') updateDashboard();
                        if(key === 'comments') renderComments();
                        if(key === 'layout') loadLayout();
                        if(key === 'theme') renderThemeView();
                        if(key === 'settings') renderSettings();
                    });
                }
            });

            elements.newPostBtn.addEventListener('click', () => { currentEditor = 'post'; elements.editorTitleInput.value = ''; elements.tagsInput.value = ''; postQuill.root.innerHTML = ''; elements.publishBtn.dataset.id = ''; switchView('postEditor'); });
            elements.backBtn.addEventListener('click', () => { switchView(lastListView); });
            elements.newPageBtn?.addEventListener('click', () => alert('Funcionalidade de nova página em breve!'));

            lucide.createIcons();
            switchView('posts');
            renderPosts();
        }
    });
    </script>
</body>
</html>