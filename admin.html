<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - iGaroto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-geo@4.3.0/build/index.umd.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>


    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f1f3f4; }
        .sidebar-item.active { background-color: #e8f0fe; color: #1967d2; font-weight: 700; }
        .sidebar-item.active i { color: #1967d2; }
        .admin-view { display: none; }
        .active-view { display: block !important; }
        #post-editor-container, #page-editor-container { height: 60vh; background-color: white; border-radius: 8px; border: 1px solid #d1d5db; }
        .ql-toolbar.ql-snow { border-top-left-radius: 8px; border-top-right-radius: 8px; border-color: #d1d5db; }
        .ql-container.ql-snow { border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; border-color: #d1d5db; border-top: 0px; }
        .ql-font-roboto { font-family: 'Roboto', sans-serif; }
        .ql-font-lato { font-family: 'Lato', sans-serif; }
        .ql-font-merriweather { font-family: 'Merriweather', serif; }
        .ql-font-arial { font-family: Arial, sans-serif; }
        .list-item .item-actions, .gadget .gadget-actions { opacity: 0; transition: opacity 0.2s ease-in-out; }
        .list-item:hover .item-actions, .gadget:hover .gadget-actions { opacity: 1; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.3); width: 36px; height: 36px; border-radius: 50%; border-left-color: #ffffff; animation: spin 1s ease infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100">

    <div id="login-screen" class="flex items-center justify-center h-screen">
        <div class="w-full max-w-md bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Admin iGaroto</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                    <input type="password" id="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full">Entrar</button>
                </div>
                <p id="login-error" class="text-red-500 text-xs italic mt-4 text-center"></p>
            </form>
        </div>
    </div>

    <div id="app-container" class="hidden h-screen bg-gray-100">
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <div class="px-6 py-4 border-b flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-700">iGAROTO</h1>
                <button id="logout-btn" title="Sair" class="text-gray-500 hover:text-red-600"><i data-lucide="log-out" class="w-5 h-5"></i></button>
            </div>
            <div class="p-4">
                <button id="new-post-btn" class="w-full bg-orange-500 text-white font-bold py-3 px-4 rounded-lg inline-flex items-center justify-center shadow hover:bg-orange-600 transition-colors">
                    <i data-lucide="plus" class="w-5 h-5 mr-2"></i><span>NOVA POSTAGEM</span>
                </button>
            </div>
            <nav id="sidebar-nav" class="flex-1 py-2 px-2 space-y-1">
                <a href="#" id="posts-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="layout-list" class="w-5 h-5 mr-3 text-gray-500"></i>Postagens</a>
                <a href="#" id="stats-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="bar-chart-3" class="w-5 h-5 mr-3 text-gray-500"></i>Estatísticas</a>
                <a href="#" id="comments-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="message-square" class="w-5 h-5 mr-3 text-gray-500"></i>Comentários</a>
                <a href="#" id="pages-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="file-text" class="w-5 h-5 mr-3 text-gray-500"></i>Páginas</a>
                <a href="#" id="layout-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="layout-template" class="w-5 h-5 mr-3 text-gray-500"></i>Layout</a>
                <a href="#" id="theme-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="palette" class="w-5 h-5 mr-3 text-gray-500"></i>Tema</a>
                <a href="#" id="settings-link" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-r-full hover:bg-gray-200"><i data-lucide="settings" class="w-5 h-5 mr-3 text-gray-500"></i>Configurações</a>
            </nav>
            <div class="px-4 py-2 border-t">
                <a href="index.html" target="_blank" class="sidebar-item flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-200"><i data-lucide="eye" class="w-5 h-5 mr-3 text-gray-500"></i>Ver blog</a>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header id="main-header" class="bg-white border-b border-gray-200 p-2 flex items-center justify-between">
                 <div class="relative w-full max-w-md">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                    <input type="text" placeholder="Pesquisar" class="w-full bg-gray-100 rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex items-center gap-4">
                    <button class="text-gray-500 hover:text-gray-800"><i data-lucide="help-circle" class="w-6 h-6"></i></button>
                    <img id="user-avatar" src="https://placehold.co/40x40/ff8a8a/ffffff?text=W" alt="User Avatar" class="w-8 h-8 rounded-full cursor-pointer">
                </div>
            </header>
            <header id="editor-header" class="hidden bg-white border-b border-gray-200 p-2 items-center justify-between">
                <div class="flex items-center gap-2">
                    <button id="back-btn" class="text-gray-500 hover:text-gray-800 p-2 rounded-full hover:bg-gray-100"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
                    <input id="editor-title-input" type="text" placeholder="Título da postagem" class="text-2xl bg-transparent focus:outline-none w-full placeholder-gray-400 font-normal">
                </div>
                <div class="flex items-center gap-3 mr-4">
                    <button id="publish-btn" class="text-sm text-white bg-orange-500 hover:bg-orange-600 px-5 py-2 rounded-md font-bold">Publicar</button>
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                
                <div id="posts-list-view" class="admin-view"></div>
                <div id="post-editor-view" class="admin-view"></div>
                <div id="pages-list-view" class="admin-view"></div>
                <div id="page-editor-view" class="admin-view"></div>
                <div id="settings-view" class="admin-view"></div>
                <div id="stats-view" class="admin-view"></div>
                <div id="comments-view" class="admin-view"></div>
                <div id="layout-view" class="admin-view"></div>
                
                <div id="theme-view" class="admin-view">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-normal text-gray-800">Tema</h2>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <h3 class="text-lg font-medium mb-4">Meu tema</h3>
                        <div class="flex gap-6 items-center">
                            <div id="current-theme-thumbnail" class="w-1/3">
                                <img src="https://placehold.co/400x250/f1f3f4/333?text=Simples" alt="Tema Simples" class="w-full rounded-lg border">
                            </div>
                            <div class="flex-1">
                                <h4 id="current-theme-name" class="text-xl font-semibold">Simples</h4>
                                <p class="text-gray-600 mb-4">Este é o tema que está ativo no seu blog.</p>
                                <div class="flex gap-4">
                                    <button id="customize-theme-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700">Personalizar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="theme-customizer-view" class="admin-view">
                     <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-normal text-gray-800">Personalizar Tema</h2>
                        <div class="flex gap-4">
                            <button id="back-to-themes-btn" class="border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md hover:bg-gray-100">Voltar</button>
                            <button id="restore-theme-btn" class="border border-gray-300 text-red-600 font-semibold py-2 px-4 rounded-md hover:bg-gray-100">Restaurar Padrão</button>
                            <button id="save-customizations-btn" class="bg-orange-500 text-white font-bold py-2 px-6 rounded-md shadow hover:bg-orange-600">Salvar</button>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border max-w-2xl mx-auto">
                        <div class="space-y-6">
                            <div>
                                <label for="bg-color-picker" class="block text-sm font-medium text-gray-700">Cor de fundo principal</label>
                                <input type="color" id="bg-color-picker" value="#f0f2f5" class="mt-1 w-full h-10 p-1 border border-gray-300 rounded-md">
                            </div>
                             <div>
                                <label for="text-color-picker" class="block text-sm font-medium text-gray-700">Cor do texto principal</label>
                                <input type="color" id="text-color-picker" value="#374151" class="mt-1 w-full h-10 p-1 border border-gray-300 rounded-md">
                            </div>
                             <div>
                                <label for="link-color-picker" class="block text-sm font-medium text-gray-700">Cor dos links e detalhes</label>
                                <input type="color" id="link-color-picker" value="#4f46e5" class="mt-1 w-full h-10 p-1 border border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    
    <div id="upload-modal" class="modal-overlay hidden"><div class="spinner"></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
          apiKey: "AIzaSyBYvn_AEoXo2ei2zRSg9EZhAeicF0QfY3s",
          authDomain: "igaroto-site-oficial.firebaseapp.com",
          projectId: "igaroto-site-oficial",
          storageBucket: "igaroto-site-oficial.firebasestorage.app",
          messagingSenderId: "217633468562",
          appId: "1:217633468562:web:236b1b72034a5a675cb64b"
        };
        firebase.initializeApp(firebaseConfig);
        
        const auth = firebase.auth();
        const db = firebase.firestore();

        const loginScreen = document.getElementById('login-screen');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const logoutBtn = document.getElementById('logout-btn');

        auth.onAuthStateChanged(user => {
            if (user && !user.isAnonymous) {
                loginScreen.style.display = 'none';
                appContainer.style.display = 'flex';
                runApp();
            } else {
                loginScreen.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password).catch(error => {
                document.getElementById('login-error').textContent = 'E-mail ou senha inválidos.';
            });
        });

        logoutBtn.addEventListener('click', () => auth.signOut());

        function runApp() {
            const elements = {
                publishBtn: document.getElementById('publish-btn'), editorTitleInput: document.getElementById('editor-title-input'), tagsInput: document.getElementById('tags-input'), postsContainer: document.getElementById('posts-container'), newPostBtn: document.getElementById('new-post-btn'), backBtn: document.getElementById('back-btn'), 
                mainHeader: document.getElementById('main-header'), editorHeader: document.getElementById('editor-header'),
                pagesLink: document.getElementById('pages-link'), newPageBtn: document.getElementById('new-page-btn'), pagesContainer: document.getElementById('pages-container'),
                themeLink: document.getElementById('theme-link'), customizeThemeBtn: document.getElementById('customize-theme-btn'), backToThemesBtn: document.getElementById('back-to-themes-btn'),
                saveCustomizationsBtn: document.getElementById('save-customizations-btn'), restoreThemeBtn: document.getElementById('restore-theme-btn'), bgColorPicker: document.getElementById('bg-color-picker'), textColorPicker: document.getElementById('text-color-picker'), linkColorPicker: document.getElementById('link-color-picker'),
            };

            const views = {
                posts: document.getElementById('posts-list-view'), postEditor: document.getElementById('post-editor-view'), pages: document.getElementById('pages-list-view'), pageEditor: document.getElementById('page-editor-view'), stats: document.getElementById('stats-view'), comments: document.getElementById('comments-view'), layout: document.getElementById('layout-view'), theme: document.getElementById('theme-view'), settings: document.getElementById('settings-view'), themeCustomizer: document.getElementById('theme-customizer-view')
            };

            const navLinks = {
                posts: document.getElementById('posts-link'), stats: document.getElementById('stats-link'), comments: document.getElementById('comments-link'), pages: document.getElementById('pages-link'), layout: document.getElementById('layout-link'), theme: document.getElementById('theme-link'), settings: document.getElementById('settings-link'),
            };

            let lastListView = 'posts';
            let currentEditor = null;
            const uploadModal = document.getElementById('upload-modal');
            
            async function vercelBlobUpload(file) {
                uploadModal.classList.remove('hidden');
                const response = await fetch(`/api/upload-image?filename=${file.name}`, { method: 'POST', body: file });
                if (!response.ok) { throw new Error('A resposta da rede para o upload não foi ok.'); }
                const newBlob = await response.json();
                uploadModal.classList.add('hidden');
                return newBlob.url;
            }
            
            function imageHandler() {
                const input = document.createElement('input');
                input.setAttribute('type', 'file'); input.setAttribute('accept', 'image/*');
                input.click();
                input.onchange = async () => {
                    const file = input.files[0]; if (!file) return;
                    if (/^image\//.test(file.type)) {
                        try {
                            const url = await vercelBlobUpload(file);
                            const range = this.quill.getSelection(true);
                            this.quill.insertEmbed(range.index, 'image', url);
                        } catch (error) { console.error('Falha no upload da imagem:', error); alert('Falha no upload da imagem.'); uploadModal.classList.add('hidden');}
                    } else { alert('Por favor, selecione um arquivo de imagem válido.'); }
                };
            }

            const quillOptions = { modules: { toolbar: { container: [
                [{ 'font': [] }, { 'header': [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'], ['blockquote', 'code-block'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'align': [] }], ['link', 'image'], ['clean']
            ], handlers: { 'image': imageHandler }}}, theme: 'snow', placeholder: 'Comece a escrever...'};
            const postQuill = new Quill('#post-editor-container', quillOptions);
            const pageQuill = new Quill('#page-editor-container', {theme: 'snow', placeholder: 'Conteúdo da página...'});

            const renderPosts = async () => {
                try {
                    views.posts.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Postagens</h2></div><div id="posts-container" class="bg-white rounded-lg shadow-sm border border-gray-200"><p class="p-4 text-center">Carregando...</p></div>`;
                    const container = document.getElementById('posts-container');
                    const snapshot = await db.collection('posts').orderBy('createdAt', 'desc').get();
                    container.innerHTML = '';
                    if (snapshot.empty) { container.innerHTML = `<p class="p-4 text-center text-gray-500">Nenhuma postagem encontrada.</p>`; return; }
                    snapshot.forEach(doc => {
                        const post = { id: doc.id, ...doc.data() };
                        const el = document.createElement('div');
                        el.className = 'list-item flex items-center p-4 border-b last:border-b-0';
                        const postDate = post.createdAt?.toDate().toLocaleDateString('pt-BR', {day:'numeric', month:'short'}) || '';
                        el.innerHTML = `<div class="flex-1 cursor-pointer" onclick="window.editPost('${post.id}')"><p class="font-medium text-gray-800 hover:underline">${post.title||'(Sem Título)'}</p><div class="text-sm text-gray-500 mt-1"><span>Publicada</span> &middot; <span>${postDate}</span></div></div><div class="item-actions flex items-center gap-3 text-gray-500"><button onclick="window.deletePost('${post.id}')" title="Excluir" class="hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>`;
                        container.appendChild(el);
                    });
                    lucide.createIcons();
                } catch (e) { console.error("Erro ao carregar posts:", e); }
            };

            window.editPost = async (id) => {
                const docSnap = await db.collection('posts').doc(id).get();
                if (docSnap.exists) {
                    const post = docSnap.data();
                    currentEditor = 'post';
                    elements.editorTitleInput.value = post.title;
                    elements.tagsInput.value = post.tags?.join(', ') || '';
                    postQuill.root.innerHTML = post.content;
                    elements.publishBtn.dataset.id = id;
                    switchView('postEditor');
                }
            };
            window.deletePost = async (id) => {
                if (confirm('Tem certeza que deseja excluir este post?')) {
                    await db.collection('posts').doc(id).delete();
                    renderPosts();
                }
            };

            elements.publishBtn.addEventListener('click', async () => {
                const id = elements.publishBtn.dataset.id;
                const title = elements.editorTitleInput.value.trim();
                if (!title) return alert('Adicione um título.');
                let content = (currentEditor === 'post') ? postQuill.root.innerHTML : pageQuill.root.innerHTML;
                const dataToSave = { title, content, updatedAt: new Date() };
                if (currentEditor === 'post') dataToSave.tags = elements.tagsInput.value.split(',').map(t => t.trim()).filter(Boolean);
                try {
                    const collectionName = currentEditor + 's';
                    if (id) { await db.collection(collectionName).doc(id).update(dataToSave); }
                    else { dataToSave.createdAt = new Date(); await db.collection(collectionName).add(dataToSave); }
                    switchView(collectionName);
                } catch (error) { console.error("Erro ao salvar:", error); alert("Erro ao salvar."); }
            });
            
            const switchView = (viewKey) => {
                Object.values(views).forEach(v => { if(v) v.classList.remove('active-view'); });
                if(views[viewKey]) views[viewKey].classList.add('active-view');
                const isEditor = viewKey === 'postEditor' || viewKey === 'pageEditor' || viewKey === 'themeCustomizer';
                elements.mainHeader.style.display = isEditor ? 'none' : 'flex';
                elements.editorHeader.style.display = (viewKey === 'postEditor' || viewKey === 'pageEditor') ? 'flex' : 'none';
                if(viewKey === 'themeCustomizer') elements.editorHeader.style.display = 'none'; // Esconde header principal no customizer
                
                Object.values(navLinks).forEach(l => l && l.classList.remove('active'));
                if(navLinks[viewKey]) { navLinks[viewKey].classList.add('active'); if(!isEditor) lastListView = viewKey; }
            };
            
            // Funções para renderizar as outras seções
            const renderPages = () => { views.pages.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-normal text-gray-800">Páginas</h2><button id="new-page-btn-inner" class="bg-orange-500 text-white font-bold py-2 px-4 rounded-md">NOVA PÁGINA</button></div><p class="mt-4 p-4 bg-white rounded-lg">Funcionalidade de páginas em breve.</p>`; };
            const updateDashboard = () => { views.stats.innerHTML = `<h2 class="text-2xl font-normal text-gray-800 mb-6">Estatísticas</h2><p class="mt-4 p-4 bg-white rounded-lg">Funcionalidade de estatísticas em breve.</p>`; };
            const renderComments = () => { views.comments.innerHTML = `<h2 class="text-2xl font-normal text-gray-800 mb-6">Comentários</h2><p class="mt-4 p-4 bg-white rounded-lg">Funcionalidade de comentários em breve.</p>`; };
            const loadLayout = () => { views.layout.innerHTML = `<h2 class="text-2xl font-normal text-gray-800 mb-6">Layout</h2><p class="mt-4 p-4 bg-white rounded-lg">Funcionalidade de layout em breve.</p>`; };
            const renderSettings = () => { views.settings.innerHTML = `<h2 class="text-2xl font-normal text-gray-800 mb-6">Configurações</h2><p class="mt-4 p-4 bg-white rounded-lg">Funcionalidade de configurações em breve.</p>`; };
            
            const renderThemeView = async () => {
                switchView('theme');
                try {
                    const doc = await db.collection('settings').doc('theme').get();
                    if (doc.exists) {
                        const themeData = doc.data();
                        elements.bgColorPicker.value = themeData.colors.background;
                        elements.textColorPicker.value = themeData.colors.text;
                        elements.linkColorPicker.value = themeData.colors.link;
                    }
                } catch (e) { console.error("Erro ao carregar configurações do tema:", e); }
            };
            
            elements.customizeThemeBtn.addEventListener('click', () => switchView('themeCustomizer'));
            elements.backToThemesBtn.addEventListener('click', () => switchView('theme'));

            elements.saveCustomizationsBtn.addEventListener('click', async () => {
                const colors = {
                    background: elements.bgColorPicker.value,
                    text: elements.textColorPicker.value,
                    link: elements.linkColorPicker.value,
                };
                try {
                    await db.collection('settings').doc('theme').set({ colors });
                    alert('Tema salvo com sucesso!');
                    switchView('theme');
                } catch (e) {
                    console.error("Erro ao salvar tema:", e);
                    alert('Ocorreu um erro ao salvar o tema.');
                }
            });

            elements.restoreThemeBtn.addEventListener('click', async () => {
                if (confirm('Tem certeza que deseja restaurar as cores padrão do tema?')) {
                    try {
                        await db.collection('settings').doc('theme').delete();
                        // Resetar os inputs de cor para os valores padrão
                        elements.bgColorPicker.value = '#f0f2f5';
                        elements.textColorPicker.value = '#374151';
                        elements.linkColorPicker.value = '#4f46e5';
                        alert('Tema restaurado para o padrão!');
                    } catch(e) {
                        console.error("Erro ao restaurar tema:", e);
                        alert('Ocorreu um erro ao restaurar o tema.');
                    }
                }
            });

            Object.keys(navLinks).forEach(key => {
                if(navLinks[key]) {
                    navLinks[key].addEventListener('click', (e) => {
                        e.preventDefault();
                        switchView(key);
                        if(key === 'posts') renderPosts();
                        if(key === 'pages') renderPages();
                        if(key === 'stats') updateDashboard();
                        if(key === 'comments') renderComments();
                        if(key === 'layout') loadLayout();
                        if(key === 'theme') renderThemeView();
                        if(key === 'settings') renderSettings();
                    });
                }
            });

            elements.newPostBtn.addEventListener('click', () => { currentEditor = 'post'; elements.editorTitleInput.value = ''; elements.tagsInput.value = ''; postQuill.root.innerHTML = ''; elements.publishBtn.dataset.id = ''; switchView('postEditor'); });
            elements.newPageBtn?.addEventListener('click', () => { currentEditor = 'page'; elements.editorTitleInput.value = ''; pageQuill.root.innerHTML = ''; elements.publishBtn.dataset.id = ''; switchView('pageEditor'); });
            elements.backBtn.addEventListener('click', () => { switchView(lastListView); });

            lucide.createIcons();
            switchView('posts');
            renderPosts();
        }
    });
    </script>
</body>
</html>