<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iGaroto - Seu Portal de Estilo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
        }
        .main-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        .post-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
        }
        .sidebar-widget {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .animated-gradient-text {
            font-weight: 900;
            background: linear-gradient(90deg, #ff8a8a, #ffc3c3, #ff8a8a);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 4s linear infinite;
        }

        @keyframes shine {
            to {
                background-position: -200% center;
            }
        }

        .story-slider .swiper-slide {
            text-align: center;
            font-size: 14px;
        }
        .story-slider .story-image-wrapper {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            padding: 4px;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); 
            margin: 0 auto 8px;
        }
        .story-slider img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #fff;
        }

        .social-icon {
            transition: transform 0.2s ease, filter 0.2s ease;
        }
        .social-icon:active {
            transform: scale(0.9);
            filter: brightness(0.8);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #ffffff;
            min-width: 120px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 50;
            border-radius: 8px;
            overflow: hidden;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }

        .ad-block {
            background-color: #000000;
            color: #ffffff;
            padding: 1rem;
            border-radius: 4px;
            text-align: center;
        }
        .ad-block .ad-code-title {
            font-weight: bold;
            font-size: 0.875rem;
            letter-spacing: 0.1em;
        }
        .ad-block .ad-responsive-text {
            background-color: #d1d5db;
            color: #000000;
            font-size: 0.75rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 2px;
        }
        .single-post-content img {
            pointer-events: auto;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app">
        <div class="bg-white border-b border-gray-200">
            <div class="main-container px-4 py-2 flex justify-between items-center text-sm text-gray-600">
                <nav id="top-nav" class="flex gap-4">
                    <a href="index.html" class="hover:text-indigo-600" data-translate-key="top_home">Home</a>
                </nav>
                <div class="flex gap-4 items-center">
                    <a href="https://www.facebook.com/igaroto" target="_blank" class="hover:opacity-75"><i data-lucide="facebook" class="w-4 h-4"></i></a>
                    <a href="https://www.instagram.com/igaroto" target="_blank" class="hover:opacity-75"><i data-lucide="instagram" class="w-4 h-4"></i></a>
                </div>
            </div>
        </div>

        <header class="bg-white sticky top-0 z-40 shadow-md">
            <div class="main-container px-4 py-4 flex justify-between items-center">
                <a href="index.html" class="text-4xl animated-gradient-text">iGAROTO</a>
                
                <nav class="hidden md:flex items-center gap-4">
                     <div class="dropdown">
                        <button class="flex items-center gap-1 font-semibold hover:text-indigo-600">
                            MENU <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="index.html" data-translate-key="nav_home">Home</a>
                            <a href="#" data-translate-key="nav_boys">Boys</a>
                            <a href="#" data-translate-key="nav_signs">Signos</a>
                            <a href="#" data-translate-key="nav_about">Sobre</a>
                        </div>
                    </div>
        
                    <div class="relative">
                        <button id="search-icon-btn" class="hover:text-indigo-600"><i data-lucide="search" class="w-6 h-6"></i></button>
                        <div id="search-bar" class="hidden absolute top-full right-0 mt-2 w-64 z-50">
                            <form id="search-form">
                                <input type="text" name="q" placeholder="Pesquisar..." class="w-full border border-gray-300 rounded-md p-2 shadow-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            </form>
                        </div>
                    </div>
                    
                    <div class="dropdown">
                        <button class="hover:text-indigo-600"><i data-lucide="globe" class="w-6 h-6"></i></button>
                        <div class="dropdown-content">
                            <a href="javascript:void(0)" onclick="setLanguage('pt')">Português</a>
                            <a href="javascript:void(0)" onclick="setLanguage('en')">English</a>
                            <a href="javascript:void(0)" onclick="setLanguage('es')">Español</a>
                        </div>
                    </div>
                </nav>
                
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="flex items-center gap-2 hover:text-indigo-600 font-semibold">
                        <span>MENU</span>
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </header>

        <div id="mobile-menu-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
        <div id="mobile-menu" class="fixed top-0 left-0 h-full w-64 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out">
            <div class="p-4 border-b">
                <h2 class="font-bold text-xl">Menu</h2>
            </div>
            <nav class="mt-4">
                <a href="index.html" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_home">Home</a>
                <a href="#" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_boys">Boys</a>
                <a href="#" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_signs">Signos</a>
                <a href="#" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_about">Sobre</a>
            </nav>
        </div>
        <div id="main-content-area" class="main-container px-4 mt-8">
            </div>

        <footer class="bg-gray-800 text-white mt-12">
            <div class="main-container px-4 py-8 text-center">
                <p data-translate-key="footer_rights">&copy; 2024 iGaroto. Todos os direitos reservados.</p>
                <p class="text-sm text-gray-400 mt-2" data-translate-key="footer_dev">Desenvolvido com &hearts; para a comunidade.</p>
                 <a href="admin.html" target="_blank" class="mt-4 text-xs text-gray-500 hover:text-indigo-400" data-translate-key="admin_login">Admin Login</a>
            </div>
        </footer>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const staticTranslations = {
                top_about: { pt: 'Sobre', en: 'About', es: 'Sobre' },
                top_contact: { pt: 'Contato', en: 'Contact', es: 'Contacto' },
                top_home: { pt: 'Home', en: 'Home', es: 'Inicio' },
                nav_home: { pt: 'Home', en: 'Home', es: 'Inicio' },
                nav_boys: { pt: 'Boys', en: 'Boys', es: 'Chicos' },
                nav_signs: { pt: 'Signos', en: 'Zodiac', es: 'Signos' },
                nav_about: { pt: 'Sobre', en: 'About', es: 'Sobre' },
                story_makeup: { pt: 'Maquiagem', en: 'Makeup', es: 'Maquillaje' },
                story_about_us: { pt: 'Sobre Nós', en: 'About Us', es: 'Sobre Nosotros' },
                story_test: { pt: 'Teste', en: 'Test', es: 'Prueba' },
                story_signs: { pt: 'Signos', en: 'Zodiac', es: 'Signos' },
                story_fashion: { pt: 'Moda', en: 'Fashion', es: 'Moda' },
                story_news: { pt: 'Novidades', en: 'News', es: 'Noticias' },
                story_tips: { pt: 'Dicas', en: 'Tips', es: 'Consejos' },
                recent_posts: { pt: 'POSTAGENS RECENTES', en: 'RECENT POSTS', es: 'PUBLICACIONES RECIENTES' },
                read_more: { pt: 'LEIA MAIS &raquo;', en: 'READ MORE &raquo;', es: 'LEER MÁS &raquo;' },
                social_plugin: { pt: 'SOCIAL PLUGIN', en: 'SOCIAL PLUGIN', es: 'PLUGIN SOCIAL' },
                advertise_here: { pt: 'ANUNCIE AQUI', en: 'ADVERTISE HERE', es: 'ANUNCIE AQUÍ' },
                most_popular: { pt: 'MAIS POPULARES', en: 'MOST POPULAR', es: 'MÁS POPULARES' },
                popular1_title: { pt: 'Dicas de estilo para o verão 2024', en: 'Style tips for summer 2024', es: 'Consejos de estilo para el verano de 2024' },
                popular1_date: { pt: 'Janeiro 15, 2024', en: 'January 15, 2024', es: '15 de Enero, 2024' },
                popular2_title: { pt: 'Os melhores perfumes masculinos', en: 'The best male perfumes', es: 'Los mejores perfumes masculinos' },
                popular2_date: { pt: 'Fevereiro 02, 2024', en: 'February 02, 2024', es: '02 de Febrero, 2024' },
                footer_rights: { pt: '&copy; 2024 iGaroto. Todos os direitos reservados.', en: '&copy; 2024 iGaroto. All rights reserved.', es: '&copy; 2024 iGaroto. Todos los derechos reservados.' },
                footer_dev: { pt: 'Desenvolvido com &hearts; para a comunidade.', en: 'Developed with &hearts; for the community.', es: 'Desarrollado con &hearts; para la comunidad.' },
                admin_login: { pt: 'Admin Login', en: 'Admin Login', es: 'Acceso Admin' }
            };

            const firebaseConfig = {
              apiKey: "AIzaSyBYvn_AEoXo2ei2zRSg9EZhAeicF0QfY3s",
              authDomain: "igaroto-site-oficial.firebaseapp.com",
              projectId: "igaroto-site-oficial",
              storageBucket: "igaroto-site-oficial.firebasestorage.app",
              messagingSenderId: "217633468562",
              appId: "1:217633468562:web:236b1b72034a5a675cb64b",
              measurementId: "G-B9NBBEZTSW"
            };
            
            try {
                firebase.initializeApp(firebaseConfig);
                firebase.analytics();
            } catch(e) { console.error("Erro ao inicializar o Firebase", e); }

            const auth = firebase.auth();
            const db = firebase.firestore();
            const mainContentArea = document.getElementById('main-content-area');
            const translationCache = {};
            let currentLanguage = 'pt';

            async function callGemini(prompt) {
                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(prompt)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }
                
                const result = await response.json();
                return result.translatedText;
            }

            async function applyTranslation() {
                const lang = currentLanguage;
                
                document.querySelectorAll('[data-translate-key]').forEach(element => {
                    const key = element.getAttribute('data-translate-key');
                    if (staticTranslations[key] && staticTranslations[key][lang]) {
                        element.innerHTML = staticTranslations[key][lang];
                    }
                });

                if (lang === 'pt') {
                    document.querySelectorAll('[data-original-text]').forEach(el => {
                        el.innerText = el.dataset.originalText;
                    });
                    document.querySelectorAll('[data-original-text-html]').forEach(el => {
                        el.innerHTML = decodeURIComponent(el.dataset.originalTextHtml);
                    });
                    return;
                }

                const elementsToTranslate = document.querySelectorAll('[data-original-text], [data-original-text-html]');
                for (const el of elementsToTranslate) {
                    const isHtml = el.hasAttribute('data-original-text-html');
                    const originalText = isHtml ? decodeURIComponent(el.dataset.originalTextHtml) : el.dataset.originalText;
                    const cacheKey = `${lang}:${originalText}`;

                    if (translationCache[cacheKey]) {
                        el.innerHTML = translationCache[cacheKey];
                        continue;
                    }
                    
                    const originalContent = el.innerHTML;
                    el.innerHTML = 'Traduzindo...';
                    
                    try {
                        const prompt = {
                            textToTranslate: originalText,
                            targetLang: lang,
                            isHtml: isHtml
                        };
                        const translatedText = await callGemini(prompt);
                        translationCache[cacheKey] = translatedText;
                        el.innerHTML = translatedText;
                    } catch (error) {
                        console.error("Translation error:", error);
                        el.innerHTML = originalContent;
                    }
                }
            }
            
            window.setLanguage = (lang) => {
                currentLanguage = lang;
                document.documentElement.lang = lang;
                applyTranslation();
            }
            
            async function renderHomePage(layout, searchTerm = '') {
                mainContentArea.innerHTML = `
                    <section class="mb-8 story-slider">
                        <div class="swiper-container">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">
                                    <div class="story-image-wrapper"><img src="https://placehold.co/110x110/6d28d9/ffffff?text=Make" alt="Maquiagem"></div>
                                    <span class="font-semibold" data-translate-key="story_makeup">Maquiagem</span>
                                </div>
                                <div class="swiper-slide">
                                    <div class="story-image-wrapper"><img src="https://placehold.co/110x110/be185d/ffffff?text=Sobre" alt="Sobre nós"></div>
                                    <span class="font-semibold" data-translate-key="story_about_us">Sobre Nós</span>
                                </div>
                                <div class="swiper-slide">
                                    <div class="story-image-wrapper"><img src="https://placehold.co/110x110/1e40af/ffffff?text=Teste" alt="Teste"></div>
                                    <span class="font-semibold" data-translate-key="story_test">Teste</span>
                                </div>
                                <div class="swiper-slide">
                                     <div class="story-image-wrapper"><img src="https://placehold.co/110x110/ca8a04/ffffff?text=Signo" alt="Signos"></div>
                                    <span class="font-semibold" data-translate-key="story_signs">Signos</span>
                                </div>
                                <div class="swiper-slide">
                                    <div class="story-image-wrapper"><img src="https://placehold.co/110x110/166534/ffffff?text=Moda" alt="Moda"></div>
                                    <span class="font-semibold" data-translate-key="story_fashion">Moda</span>
                                </div>
                                <div class="swiper-slide">
                                    <div class="story-image-wrapper"><img src="https://placehold.co/110x110/b91c1c/ffffff?text=News" alt="Novidades"></div>
                                    <span class="font-semibold" data-translate-key="story_news">Novidades</span>
                                </div>
                                 <div class="swiper-slide">
                                    <div class="story-image-wrapper"><img src="https://placehold.co/110x110/9a3412/ffffff?text=Dicas" alt="Dicas"></div>
                                    <span class="font-semibold" data-translate-key="story_tips">Dicas</span>
                                </div>
                            </div>
                        </div>
                    </section>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <h2 id="page-title" class="text-xl font-bold border-b-4 border-indigo-600 pb-2 mb-6 inline-block" data-translate-key="recent_posts">POSTAGENS RECENTES</h2>
                            <div id="posts-container" class="space-y-8"></div>
                        </div>
                        <aside id="sidebar-container" class="lg:col-span-1">
                        </aside>
                    </div>
                `;
                new Swiper('.story-slider .swiper-container', {
                    slidesPerView: 3, spaceBetween: 10, loop: true, autoplay: { delay: 3000, disableOnInteraction: false },
                    breakpoints: { 640: { slidesPerView: 4, spaceBetween: 20 }, 768: { slidesPerView: 5, spaceBetween: 30 }, 1024: { slidesPerView: 6, spaceBetween: 30 } },
                });
                renderGadgets(layout.sidebar, 'sidebar-container');
                
                await loadPosts(searchTerm);
            }

            async function renderSinglePost(postId, layout) {
                mainContentArea.innerHTML = `<p class="text-center text-gray-600">Carregando postagem...</p>`;
                try {
                    const docRef = db.collection('posts').doc(postId);
                    const docSnap = await docRef.get();

                    if (docSnap.exists) {
                        const post = docSnap.data();
                        const postDate = post.createdAt ? new Date(post.createdAt.toDate()).toLocaleDateString('pt-BR', { year: 'numeric', month: 'long', day: 'numeric' }) : '';
                        
                        document.title = `${post.title} - iGaroto`;

                        mainContentArea.innerHTML = `
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div class="lg:col-span-2 bg-white p-6 md:p-10 rounded-lg shadow-md">
                                    <a href="index.html" class="inline-flex items-center text-indigo-600 font-semibold mb-6 hover:underline">
                                        <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                                        Voltar para todos os posts
                                    </a>
                                    <h1 class="text-4xl md:text-5xl font-bold mb-4" data-original-text="${post.title.replace(/"/g, '&quot;')}">${post.title}</h1>
                                    <div class="text-sm text-gray-500 mb-6">
                                        <span>Por <strong>iGaroto</strong></span> &bull;
                                        <span>${postDate}</span>
                                    </div>
                                    <div class="prose lg:prose-xl max-w-none single-post-content" data-original-text-html="${encodeURIComponent(post.content)}">
                                        ${post.content}
                                    </div>
                                </div>
                                <aside id="sidebar-container" class="lg:col-span-1">
                                </aside>
                            </div>
                        `;
                        renderGadgets(layout.sidebar, 'sidebar-container');
                    } else {
                        mainContentArea.innerHTML = '<p class="text-center text-red-500">Postagem não encontrada.</p>';
                    }
                } catch (error) {
                    console.error("Erro ao carregar postagem única:", error);
                    mainContentArea.innerHTML = '<p class="text-center text-red-500">Ocorreu um erro ao carregar a postagem.</p>';
                }
                lucide.createIcons();
                await applyTranslation();
            }

            async function loadPosts(searchTerm = '') {
                const postsContainer = document.getElementById('posts-container');
                if (!postsContainer) return;

                if (searchTerm) {
                    document.getElementById('page-title').textContent = `Resultados para: "${searchTerm}"`;
                    const slider = document.querySelector('.story-slider');
                    if (slider) slider.remove();
                }

                postsContainer.innerHTML = `<p class="text-center text-gray-600">Carregando as últimas novidades...</p>`;
                try {
                    const snapshot = await db.collection('posts').orderBy('createdAt', 'desc').get();
                    
                    let posts = [];
                    snapshot.forEach(doc => posts.push({ id: doc.id, ...doc.data() }));

                    if (searchTerm) {
                        posts = posts.filter(post => post.title.toLowerCase().includes(searchTerm.toLowerCase()));
                    }

                    if (posts.length === 0) {
                        postsContainer.innerHTML = `<p class="text-center text-gray-600">${searchTerm ? 'Nenhum resultado encontrado.' : 'Ainda não há nenhuma postagem. Volte em breve!'}</p>`;
                        return;
                    }

                    postsContainer.innerHTML = ''; 
                    posts.forEach(post => {
                        const postElement = document.createElement('article');
                        postElement.className = 'post-card flex flex-col md:flex-row rounded-lg overflow-hidden shadow-sm hover:shadow-xl transition-shadow duration-300';
                        
                        const tempDiv = document.createElement("div");
                        tempDiv.innerHTML = post.content;
                        const description = tempDiv.textContent || tempDiv.innerText || "";
                        const summary = description.substring(0, 150) + (description.length > 150 ? '...' : '');

                        const postDate = post.createdAt ? new Date(post.createdAt.toDate()).toLocaleDateString('pt-BR', { year: 'numeric', month: 'long', day: 'numeric' }) : '';
                        
                        const firstImageMatch = post.content.match(/<img src="([^"]+)"/);
                        const imageUrl = firstImageMatch ? firstImageMatch[1] : 'https://placehold.co/400x400/111827/ffffff?text=iGaroto';

                        const category = post.tags && post.tags.length > 0 ? post.tags[0] : 'Novidades';

                        postElement.innerHTML = `
                            <div class="md:w-1/3"><img src="${imageUrl}" class="w-full h-full object-cover" alt="${post.title}"></div>
                            <div class="p-6 flex flex-col justify-center md:w-2/3">
                                <span class="text-white bg-red-600 px-2 py-1 text-xs font-bold rounded self-start mb-2">${category}</span>
                                <h3 class="text-2xl font-bold mb-2 hover:text-indigo-600" data-original-text="${post.title.replace(/"/g, '&quot;')}"><a href="?post=${post.id}">${post.title}</a></h3>
                                <p class="text-gray-600 text-sm mb-4" data-original-text="${summary.replace(/"/g, '&quot;')}">${summary}</p>
                                <div class="text-xs text-gray-500"><span>By <a href="#" class="font-semibold hover:text-black">iGaroto</a></span> - <span>${postDate}</span></div>
                                <a href="?post=${post.id}" class="text-indigo-600 font-semibold mt-4 self-start" data-translate-key="read_more">LEIA MAIS &raquo;</a>
                            </div>
                        `;
                        postsContainer.appendChild(postElement);
                    });
                } catch (error) {
                    console.error("Erro ao carregar posts do Firestore: ", error);
                    postsContainer.innerHTML = `<p class="text-center text-red-500">Não foi possível carregar as postagens.</p>`;
                }
            }

            function renderGadgets(gadgets, containerId) {
                const container = document.getElementById(containerId);
                if (!container || !gadgets) return;
                container.innerHTML = '';

                gadgets.forEach(gadget => {
                    const widget = document.createElement('div');
                    widget.className = 'sidebar-widget';
                    let content = `<h4 class="font-bold border-b pb-2 mb-4">${gadget.title}</h4>`;

                    if (gadget.type === 'search') {
                        content += `<form action="index.html" method="GET"><input type="text" name="q" placeholder="Pesquisar no blog..." class="w-full border border-gray-300 rounded-md p-2"></form>`;
                    } else if (gadget.type === 'html') {
                        content += `<div>${gadget.content || ''}</div>`;
                    } else if (gadget.type === 'social') {
                        content += `<div class="flex gap-4">
                            <a href="https://www.facebook.com/igaroto" target="_blank" class="social-icon w-10 h-10 flex items-center justify-center bg-[#1877F2] text-white rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a>
                            <a href="https://www.instagram.com/igaroto" target="_blank" class="social-icon w-10 h-10 flex items-center justify-center bg-gradient-to-br from-yellow-400 via-red-500 to-purple-600 text-white rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg></a>
                            <a href="https://www.x.com/igarotoinsta" target="_blank" class="social-icon w-10 h-10 flex items-center justify-center bg-black text-white rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-1.8 13.05h1.56l-4.726-5.462-1.634-1.89-1.56-1.807H3.08l4.726 5.462 1.634 1.89 1.56 1.807Z"/></svg></a>
                        </div>`;
                    }
                    
                    widget.innerHTML = content;
                    container.appendChild(widget);
                });
            }
            
            async function initializeSite() {
                try {
                    const layoutDoc = await db.collection('settings').doc('layout').get();
                    const layout = layoutDoc.exists ? layoutDoc.data() : { 
                        sidebar: [{id: `gadget_${Date.now()}`, type: 'social', title: 'Plugin Social'}], 
                        'main-menu': [] 
                    };

                    const urlParams = new URLSearchParams(window.location.search);
                    const postId = urlParams.get('post');
                    const searchTerm = urlParams.get('q');

                    if (postId) {
                        await renderSinglePost(postId, layout);
                    } else {
                        await renderHomePage(layout, searchTerm);
                    }
                    
                    const searchIconBtn = document.getElementById('search-icon-btn');
                    const searchBar = document.getElementById('search-bar');
                    const searchForm = document.getElementById('search-form');

                    if(searchIconBtn && searchBar) {
                        searchIconBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            searchBar.classList.toggle('hidden');
                            if (!searchBar.classList.contains('hidden')) {
                                searchBar.querySelector('input').focus();
                            }
                        });
                        document.addEventListener('click', (e) => {
                            if (!searchBar.contains(e.target) && !searchIconBtn.contains(e.target)) {
                                searchBar.classList.add('hidden');
                            }
                        });
                        searchForm.addEventListener('submit', (e) => {
                            e.preventDefault();
                            const formData = new FormData(e.target);
                            const query = formData.get('q');
                            window.location.href = `index.html?q=${encodeURIComponent(query)}`;
                        });
                    }
                    
                    // --- LÓGICA DO MENU MOBILE ---
                    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
                    const mobileMenu = document.getElementById('mobile-menu');
                    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

                    const openMenu = () => {
                        mobileMenu.classList.remove('-translate-x-full');
                        mobileMenu.classList.add('translate-x-0');
                        mobileMenuOverlay.classList.remove('hidden');
                    };

                    const closeMenu = () => {
                        mobileMenu.classList.remove('translate-x-0');
                        mobileMenu.classList.add('-translate-x-full');
                        mobileMenuOverlay.classList.add('hidden');
                    };

                    if (mobileMenuBtn && mobileMenu && mobileMenuOverlay) {
                        mobileMenuBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            openMenu();
                        });
                        mobileMenuOverlay.addEventListener('click', closeMenu);
                    }
                    // --- FIM DA LÓGICA DO MENU MOBILE ---
                    
                    lucide.createIcons();
                    
                    document.documentElement.lang = currentLanguage;

                } catch (error) {
                    console.error("Erro ao inicializar o site:", error);
                    mainContentArea.innerHTML = `<p class="text-center text-red-500">Ocorreu um erro fatal ao carregar a configuração do site.</p>`;
                }
            }

            auth.signInAnonymously()
                .then(() => {
                    console.log("Login anônimo no site principal bem-sucedido.");
                    initializeSite();
                })
                .catch((error) => {
                    console.error("Erro no login anônimo do site principal:", error);
                    mainContentArea.innerHTML = `<p class="text-center text-red-500">Erro de conexão. Não foi possível carregar o conteúdo.</p>`;
                });
        });
    </script>
</body>
</html>