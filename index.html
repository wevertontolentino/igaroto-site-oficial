<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iGaroto - Seu Portal de Estilo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        html, body {
            overflow-x: hidden;
            width: 100%;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            position: relative;
        }
        .main-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        .post-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
        }
        .sidebar-widget {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .animated-gradient-text {
            font-weight: 900;
            background: linear-gradient(90deg, #ff8a8a, #ffc3c3, #ff8a8a);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 4s linear infinite;
        }

        @keyframes shine {
            to {
                background-position: -200% center;
            }
        }

        .story-slider .swiper-slide {
            text-align: center;
            font-size: 14px;
        }
        .story-slider .story-image-wrapper {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            padding: 4px;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); 
            margin: 0 auto 8px;
        }
        .story-slider img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #fff;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #ffffff;
            min-width: 120px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 50;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        .dropdown-content a {
            color: black;
            padding: 10px 14px;
            text-decoration: none;
            display: block;
            text-align: left;
            font-size: 0.9rem;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .language-btn {
            border: 1px solid #ddd;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s ease-in-out;
        }
        .language-btn:hover {
            border-color: #c7c7c7;
            background-color: #f8f8f8;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app">
        <div class="bg-white border-b border-gray-200">
            <div class="main-container px-4 py-2 flex justify-between items-center text-sm text-gray-600">
                <nav id="top-nav" class="flex gap-4">
                    <a href="index.html" class="hover:text-indigo-600" data-translate-key="top_home">Home</a>
                </nav>
                <div class="flex gap-4 items-center">
                    <a href="https://www.facebook.com/igaroto" target="_blank" class="hover:opacity-75"><i data-lucide="facebook" class="w-4 h-4"></i></a>
                    <a href="https://www.instagram.com/igaroto" target="_blank" class="hover:opacity-75"><i data-lucide="instagram" class="w-4 h-4"></i></a>
                </div>
            </div>
        </div>

        <header class="bg-white sticky top-0 z-30 shadow-md">
            <div class="main-container px-4 py-4 flex justify-between items-center">
                <a href="index.html" class="text-4xl animated-gradient-text">iGAROTO</a>
                
                <nav class="hidden md:flex items-center gap-6">
                     <div class="dropdown">
                        <button class="flex items-center gap-1 font-semibold hover:text-indigo-600">
                            MENU <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="index.html" data-translate-key="nav_home">Home</a>
                            <a href="#" data-translate-key="nav_boys">Boys</a>
                            <a href="#" data-translate-key="nav_signs">Signos</a>
                            <a href="#" data-translate-key="nav_about">Sobre</a>
                        </div>
                    </div>
        
                    <div class="relative">
                        <button id="search-icon-btn" class="hover:text-indigo-600"><i data-lucide="search" class="w-6 h-6"></i></button>
                        <div id="search-bar" class="hidden absolute top-full right-0 mt-2 w-64 z-50">
                            <form id="search-form">
                                <input type="text" name="q" placeholder="Pesquisar..." class="w-full border border-gray-300 rounded-md p-2 shadow-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            </form>
                        </div>
                    </div>
                    
                    <div class="dropdown">
                        <button class="language-btn flex items-center gap-2">
                            <span id="current-language-name">Português</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-gray-500"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="javascript:void(0)" onclick="setLanguage('pt')">Português</a>
                            <a href="javascript:void(0)" onclick="setLanguage('en')">English</a>
                            <a href="javascript:void(0)" onclick="setLanguage('es')">Español</a>
                        </div>
                    </div>
                </nav>
                
                <div class="md:hidden flex items-center gap-4">
                    <div class="dropdown">
                        <button class="hover:text-indigo-600"><i data-lucide="globe" class="w-6 h-6"></i></button>
                        <div class="dropdown-content">
                           <a href="javascript:void(0)" onclick="setLanguage('pt')">Português</a>
                           <a href="javascript:void(0)" onclick="setLanguage('en')">English</a>
                           <a href="javascript:void(0)" onclick="setLanguage('es')">Español</a>
                        </div>
                    </div>
                    <button id="mobile-menu-btn" class="hover:text-indigo-600">
                        <i data-lucide="menu" class="w-7 h-7"></i>
                    </button>
                </div>
            </div>
        </header>

        <div id="mobile-menu-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
        <div id="mobile-menu" class="fixed top-0 left-0 h-full w-64 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out">
            <div class="p-4 border-b flex justify-between items-center">
                <h2 class="font-bold text-xl">Menu</h2>
                <button id="close-mobile-menu-btn" class="hover:text-red-500"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <nav class="mt-4">
                <a href="index.html" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_home">Home</a>
                <a href="#" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_boys">Boys</a>
                <a href="#" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_signs">Signos</a>
                <a href="#" class="block py-3 px-4 text-base hover:bg-gray-100" data-translate-key="nav_about">Sobre</a>
            </nav>
        </div>
        
        <div id="main-content-area" class="main-container px-4 mt-8">
            </div>

        <footer class="bg-gray-800 text-white mt-12">
            <div class="main-container px-4 py-8 text-center">
                <p data-translate-key="footer_rights">&copy; 2024 iGaroto. Todos os direitos reservados.</p>
                <p class="text-sm text-gray-400 mt-2" data-translate-key="footer_dev">Desenvolvido com &hearts; para a comunidade.</p>
                 <a href="admin.html" target="_blank" class="mt-4 text-xs text-gray-500 hover:text-indigo-400" data-translate-key="admin_login">Admin Login</a>
            </div>
        </footer>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const staticTranslations = { /* ... (conteúdo omitido por brevidade) ... */ };

            const firebaseConfig = {
              apiKey: "AIzaSyBYvn_AEoXo2ei2zRSg9EZhAeicF0QfY3s",
              authDomain: "igaroto-site-oficial.firebaseapp.com",
              projectId: "igaroto-site-oficial",
              storageBucket: "igaroto-site-oficial.firebasestorage.app",
              messagingSenderId: "217633468562",
              appId: "1:217633468562:web:236b1b72034a5a675cb64b",
              measurementId: "G-B9NBBEZTSW"
            };
            
            try {
                firebase.initializeApp(firebaseConfig);
                firebase.analytics();
            } catch(e) { console.error("Erro ao inicializar o Firebase", e); }

            const auth = firebase.auth();
            const db = firebase.firestore();
            const mainContentArea = document.getElementById('main-content-area');
            const translationCache = {};
            let currentLanguage = 'pt';
            const languageNames = { pt: 'Português', en: 'English', es: 'Español' };

            async function callGemini(prompt) { /* ... (código inalterado) ... */ }
            async function applyTranslation() { /* ... (código inalterado) ... */ }
            
            window.setLanguage = (lang) => {
                currentLanguage = lang;
                document.documentElement.lang = lang;
                const langNameEl = document.getElementById('current-language-name');
                if (langNameEl) {
                    langNameEl.textContent = languageNames[lang];
                }
                applyTranslation();
            };
            
            // --- NOVA FUNÇÃO PARA CARREGAR OS STORIES ---
            async function loadStories() {
                const storiesContainer = document.querySelector('.story-slider .swiper-wrapper');
                if (!storiesContainer) return;

                const storyCategories = [
                    { tag: 'Maquiagem', placeholder: 'https://placehold.co/110x110/6d28d9/ffffff?text=Make', key: 'story_makeup' },
                    { tag: 'Sobre', placeholder: 'https://placehold.co/110x110/be185d/ffffff?text=Sobre', key: 'story_about_us' },
                    { tag: 'Teste', placeholder: 'https://placehold.co/110x110/1e40af/ffffff?text=Teste', key: 'story_test' },
                    { tag: 'Signos', placeholder: 'https://placehold.co/110x110/ca8a04/ffffff?text=Signo', key: 'story_signs' },
                    { tag: 'Moda', placeholder: 'https://placehold.co/110x110/166534/ffffff?text=Moda', key: 'story_fashion' },
                    { tag: 'Novidades', placeholder: 'https://placehold.co/110x110/b91c1c/ffffff?text=News', key: 'story_news' },
                    { tag: 'Dicas', placeholder: 'https://placehold.co/110x110/9a3412/ffffff?text=Dicas', key: 'story_tips' }
                ];
                
                storiesContainer.innerHTML = ''; // Limpa os stories estáticos

                try {
                    const snapshot = await db.collection('posts').orderBy('createdAt', 'desc').get();
                    const allPosts = [];
                    snapshot.forEach(doc => allPosts.push({ id: doc.id, ...doc.data() }));

                    for (const category of storyCategories) {
                        const postForStory = allPosts.find(p => p.tags && p.tags.includes(category.tag));
                        
                        let imageUrl = category.placeholder;
                        let postUrl = '#';

                        if (postForStory) {
                            const firstImageMatch = postForStory.content.match(/<img src="([^"]+)"/);
                            imageUrl = firstImageMatch ? firstImageMatch[1] : category.placeholder;
                            postUrl = `?post=${postForStory.id}`;
                        }

                        const storyHtml = `
                            <div class="swiper-slide">
                                <a href="${postUrl}">
                                    <div class="story-image-wrapper">
                                        <img src="${imageUrl}" alt="${category.tag}">
                                    </div>
                                    <span class="font-semibold" data-translate-key="${category.key}">${category.tag}</span>
                                </a>
                            </div>
                        `;
                        storiesContainer.innerHTML += storyHtml;
                    }
                } catch (error) {
                    console.error("Erro ao carregar stories dinâmicos:", error);
                    // Em caso de erro, carrega os stories estáticos como fallback
                    storiesContainer.innerHTML = ``;
                }
            }


            // --- FUNÇÃO RENDERHOMEPAGE MODIFICADA ---
            async function renderHomePage(layout, searchTerm = '') {
                mainContentArea.innerHTML = `
                    <section class="mb-8 story-slider">
                        <div class="swiper-container">
                            <div class="swiper-wrapper">
                                </div>
                        </div>
                    </section>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <h2 id="page-title" class="text-xl font-bold border-b-4 border-indigo-600 pb-2 mb-6 inline-block" data-translate-key="recent_posts">POSTAGENS RECENTES</h2>
                            <div id="posts-container" class="space-y-8"></div>
                        </div>
                        <aside id="sidebar-container" class="lg:col-span-1">
                        </aside>
                    </div>
                `;

                // Primeiro, carregamos os stories
                await loadStories();

                // Depois que os stories estão no HTML, inicializamos o Swiper
                new Swiper('.story-slider .swiper-container', {
                    slidesPerView: 3, spaceBetween: 10, loop: false, // Loop é desativado para garantir a ordem
                    breakpoints: { 640: { slidesPerView: 4, spaceBetween: 20 }, 768: { slidesPerView: 5, spaceBetween: 30 }, 1024: { slidesPerView: 6, spaceBetween: 30 } },
                });

                // Renderiza os gadgets e carrega os posts
                renderGadgets(layout.sidebar, 'sidebar-container');
                await loadPosts(searchTerm);
            }

            async function renderSinglePost(postId, layout) { /* ... (código inalterado) ... */ }
            async function loadPosts(searchTerm = '') { /* ... (código inalterado) ... */ }
            function renderGadgets(gadgets, containerId) { /* ... (código inalterado) ... */ }
            
            async function initializeSite() {
                try {
                    const layoutDoc = await db.collection('settings').doc('layout').get();
                    const layout = layoutDoc.exists ? layoutDoc.data() : { sidebar: [], 'main-menu': [] };

                    const urlParams = new URLSearchParams(window.location.search);
                    const postId = urlParams.get('post');
                    const searchTerm = urlParams.get('q');

                    if (postId) {
                        await renderSinglePost(postId, layout);
                    } else {
                        await renderHomePage(layout, searchTerm);
                    }
                    
                    // ... (resto do código de listeners inalterado) ...
                    
                    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
                    const mobileMenu = document.getElementById('mobile-menu');
                    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
                    const closeMobileMenuBtn = document.getElementById('close-mobile-menu-btn');

                    const openMenu = () => { /* ... */ };
                    window.closeMenu = () => { /* ... */ };

                    if (mobileMenuBtn && mobileMenu && mobileMenuOverlay && closeMobileMenuBtn) {
                        mobileMenuBtn.addEventListener('click', (e) => { e.stopPropagation(); openMenu(); });
                        mobileMenuOverlay.addEventListener('click', closeMenu);

                        closeMobileMenuBtn.addEventListener('click', closeMenu);
                    }
                    
                    lucide.createIcons();
                    setLanguage(currentLanguage);

                } catch (error) {
                    console.error("Erro ao inicializar o site:", error);
                    mainContentArea.innerHTML = `<p>Erro ao inicializar o site.</p>`;
                }
            }

            auth.signInAnonymously()
                .then(() => {
                    console.log("Login anônimo no site principal bem-sucedido.");
                    initializeSite();
                })
                .catch((error) => {
                    console.error("Erro no login anônimo do site principal:", error);
                    mainContentArea.innerHTML = `<p>Erro de conexão.</p>`;
                });
        });
    </script>
</body>
</html>